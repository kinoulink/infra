user www-data;
worker_processes 1;
pid /run/nginx.pid;
daemon off;

events
{
  worker_connections 768;
}

http
{
  sendfile on;
  tcp_nopush on;
  tcp_nodelay on;
  keepalive_timeout 65;
  types_hash_max_size 2048;

  include /etc/nginx/mime.types;
  default_type application/octet-stream;

  access_log off;
  error_log /dev/stderr;

	gzip on;
  gzip_disable "msie6";

  include /etc/nginx/resolvers.conf;

  {{#each services}}
    upstream stream_{{@key}}
	  {
	      server {{container}};
	  }

	  server
      {
          listen 80;
          server_name {{server_name}};

          client_max_body_size 512M;

          location /
          {
              proxy_pass      http://{{container}}:{{port}}/$request_uri;
              proxy_set_header Host $http_host;

              proxy_redirect off;
          }
      }
  {{/each}}
}